# ДЗ 2

## Индексы и ограничения

[СХЕМА](https://dbdiagram.io/d/61a362748c901501c0d5c984)

Учитывая предоставляемый проектом сервис - доставка готовых блюд, к БД будут осуществляться несколько основных типов запросов:

- От пользователей: 
  - регистрация пользователя (insert в таблицу user + связанные с ней)
  - просмотр меню (select из таблицы product_category, product, modifier + связанных с ними)
  - просмотр профиля пользователя (select из таблицы user + связанных с ней) 
  - создание заказа (insert в таблицу order + связанные с не)
  - просмотр истории заказа (select из таблицы order + связанных с ней)

- От администрации сервиса:
  - добавление блюд в меню (insert в таблицы product_category, product, modifier + связанные с ними)
  - изменение блюд в меню (update в таблицы product_category, product, modifier + связанные с ними)
  - просмотр меню (select из таблицы product_category, product, modifier + связанных с ними)
  - просмотр профилей пользователей (select из таблицы user + связанных с ней),
  - просмотр истории заказов (select из таблицы order + связанных с ней)
  - изменение статусов заказов (update в таблице order + связанных с ней)

Учитывая это, можно предположить, что: 

  - Таблицы **organization**, **organization_terminal**, **product_category** не потребуют дополнительных индексов, т.к. данные таблицы по своей сути являются справочниками с небольшим кол-вом значений. 

  - Таблицы **product**, **modifier** представляют собой меню ресторана. Потенциально могу потребовать доп. индексы в случае если старые недействительные позиции меню не будут удаляться из базы, что в будущем может привести к разрастанию данных таблиц. В этом случае индекс может понадобиться на полях: 
    - **product.name** - является названием продукта, по нему скорее всего будет осуществляться поиск со стороны пользователя и администрации. Будет иметь высокую кардинальность, т.к. по сути данный столбец является бизнес идентификатором продукта
    - **product.code** - является идентификатором продукта в системе учета ресторана (артикул), по ему скорее всего будет осуществляться поиск со стороны и администрации. Будет иметь высокую кардинальность, т.к. по сути данный столбец является еще одним идентификатором продукта
    - **modifier.name** - аналогично product.name
    - **modifier.code** - аналогично product.code

- Таблица **order** является самой высоконагруженной таблицей, т.к. представляет собой всю историю заказов сервиса. Понадобятся следующие индексы:
  - **order_number** - бизнес идентификатор заказа. Демонстрируется пользователю, используется администрацией для идентификации заказов при взаимодействии с пользователем. Будет иметь высокую кардинальность
  - **created_date** - дата создания заказа. Индекс может потребоваться для составления отчетов для администрации (список заказов за день, месяц, год и т.п.). Кардинальность не высока, т.к. на каждую дату будет приходиться множество заказов.

- Таблицы **order_item** и **order_item_modifier** представляют собой позиции конкретного заказа и потребуют индексы на FK **order_item.order_id** и **order_tem_modifier.order_item_id** для ускорения запросов, связанных с выгрузкой истории заказов. Также, возможно, потребуют индексы на FR **order_item.product_id** и **order_item_modifier.modififer_id** в зависимости от заполнения таблиц **product** и **product_modifier**

- Таблица **user** представляет собой профили пользователей сервиса. Потребует следующие индексы:
  - **mobile_number** - основным бизнес идентификатором пользователя предполагается считать номер мобильного телефона (т.к. сервисосуществляет доставку важно иметь актуальный номер телефона пользователя), в связи с этим, потребуется постоянное обращение к таблице по данному столбцу. Индекс будет иметь максимальную кардинальность в связи с уникальностью данного столбца.
  - **created_date** - дата регистрации пользователя. Индекс может потребоваться для составления отчетов для администрации (список новых пользователей за день, месяц, год и т.п.). Кардинальность средняя, т.к. на каждую дату будет приходиться некоторое кол-во регистраций.

//todo ограничения
//todo скрипты создания индексов и ограничений
